# 비동기 프로그래밍

#### 비동기적 이란?

프로세서에서 한 개의 작업이 처리되고 있을 때 끝나기를 기다리는 것이 아니라 그 동안 다른 작업을 수행할 수 있는것

작업을 비동기적으로 실행할 수 있는 API를 제공하는지 여부는 사용자가 사용하고 있는 프로그래밍( 또는 웹 브라우저)에 달려있다.

특히 웹 프로그래밍에서 유용하다.

웹 앱이 브라우저에서 특정 코드를 실행하느라 브라우저에게 제어권을 돌려주지 않으면 마치 정지된 것처럼 보일 수 있다. 이러한 현상을 blocking 이라고 부른다

즉, 사용자의 입력을 처리하느라 웹 앱이 프로세서에 대한 제어권을 브라우저에게 반환하지 않는 현상

​	ex) 어떤 버튼을 누를때 시간이 오래 걸리는 처리를 해 놓으면 처리가 끝나기 전에 아래의 코드는 실행되지 않음



#### Threads

프로그램이 작업을 완료하는 데 사용할 수 있는 단일 프로세스

각 스레드는 한 번에 하나의 작업만 수행할 수 있음

Task1 --> Task2 --> Task3

이처럼 각 작업은 순차적으로 실행됨, 다음 작업을 시작하려면 앞의 작업이 완료되어야 함

대부분의 컴퓨터는 여러 개의 CPU 코어를 가지고 있기 때문에, 한 번에 여러가지 일을 수행할 수 있다

Multiple thread 를 지원하는 프로그래밍 언어는 멀티코어 컴퓨터의 CPU를 사용하여 여러 가지 작업을 동사에 처리할 수 있다.

Thread1 : Task1 --> Task2

Thread2 : Task3 --> Tas4



#### JavaScript 

자바스크립트는 원래는 single thread 이다

컴퓨터가 여러 개의 CPU를 가지고 있어도 main thread 에서만 작업을 실행할 수 있다.

```
Main thread: Render circles to canvas --> Display alert()
```

멀티태스킹을 시도하려 하면 다음과 같은 에러가 뜸

이러한 자바스크립트의 한계를 해결하기 위해 몇 가지의 툴을 도입했다

Web Worker : 여러 개의 JavaScript 청크를 동시에 실행할 수 있도록 worker라 불리는 별도의 스레드로 보낼 수 있음. 시간이 오래 걸리는 처리는 worker를 사용해 처리하면 blocking 발생을 막을 수 있다.

Main Thread1 : Task1 --> Task2

Worker Thread : Expensive Task 3



#### Asynchronous code

web worker는 의 한계 

* DOM에 접근할 수 없음

  * UI를 업데이트 하도록 worker에게 어떠한 지시를 직접 할 수 없음(단순히 숫자만 계산)

* worker에서 실행되는 코드는 차단되지 않지만 동기적으로 실행됨

  * 함수를 사용할 때 문제 발생, 동기적으로 실행되면 함수 실행에 필요한 매개변수를 받아올 수 없는 경우가 생김

  * ex) Main Thread : Task A --> Task B

    * 이 예시에서 A 가 결과를 반환할 시간도 없이 B를 실행해버리면 에러 발생

  * 이러한 문제를 해결하기 위해 브라우저를 통해 특정 작업을 비동기적으로 실행할 수 있음 Promise 사용

  * Task A 가 서버에서 이미지를 가져오는 동안 Task B를 기다리게 할 수 있음

    * Main Thread : Task A                                     Task B

      ​       Promise  :           |---async operation---|

    * 위의 작업은 다른 곳에서 처리되므로 비동기 작업이 진행되는 동안 main thread가 차단되지 않는다.